sudo: required
addons:
  apt:
    update: true
env:
  global:
  - OPENSHIFT_VERSION=3.9.0
  - OPENSHIFT_COMMIT=191fece
  - DOCKER_USER=whaitukay+bot
  - secure: k5ZfQgmiRkU1pdGaX91CZZZL+Mu8dgmWsAHC5i01nfjpNVx4cMq3TUjVXv5ouqvkyrO8+VdWGErIIsyNw6ME2ZNsdcee8JJXPLIYsV5V73inknHOsZtum1/h7qdN+zhN3/HQMPl2tBz3kpYUZPCHNSaWS6TKp/bLnaG1uODjJtsRX7RPNufJe31z0YBVBELkWVAOOdr1DTBPVTAubfaOfs+ZEegDfGhYc5jKceYe31Fnz43S31cCSeWB6TsFcat2irU0KFRGl8dXwo4IuJ3PecqUeLpw/96jupP26JlXrdEtVuFhea1fJG42XXNjef972Q0WWYt+2nz3wRqRx/+CijwUzaBFk66q71UMyl1z2vNyYP6868vvsQZNJAELWhbrgg7zkQ4suzgBcRCov6avkCs7Jhh4ivL0Z4TPVGux3sgZO8q9iOMF1Uq1ydhs8UaCRXcEy4V5iHcDOBaCgHiy2vfY3X5JUUXSyFyJN90UItJmkg8rpOFM5Oe528iEteO3snSvXBNCVoBn1lR19q9zW0EE3O3jJoC7F0TviLvBKCC/2uV6VdhOixuy5EnCWvYM1AiaQkjpqG9Gn513cR5DCqBTaXFVJjlkCPOdDYJdbx4BgCLwl9hTd7bMaEVoG5PAFIXFtxC9Dc+tisCXMLem6uAfqSMA/JJpetRQHOvg/Mc=
  matrix:
  - OPENSHIFT_TEMPLATE=template.yml
  - OPENSHIFT_TEMPLATE=persistent-template.yml
services:
- docker
before_install:
- "./tools/travis/setupscan.sh"
- "./tools/travis/setup.sh"
script:
- "./tools/travis/scancode.sh"
- ./tools/travis/build.sh "WHAITUKAY_VERSION=openshift-travis-testing WHISK_ACTIONS_INVOKES_CONCURRENT=1000"
- "./tools/travis/test.sh"
after_failure:
- "./tools/travis/collect-logs.sh"
stages:
- docker build
- test
- deploy
jobs:
  include:
  - stage: docker build
    env: OPENSHIFT_TEMPLATE=template.yml
    before_install: skip
    script: "./tools/travis/publish.sh openshift-travis-testing"
  - stage: deploy
    env: OPENSHIFT_TEMPLATE=template.yml
    before_install: skip
    script: "./tools/travis/publish.sh"
